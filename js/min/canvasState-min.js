function rotate(e){switch(height=Math.floor(tHeight),e[0].color){case"#9013FE":switch(!0){case(1===Math.ceil(e[0].x-e[2].x)||0===Math.ceil(e[0].x-e[2].x))&&Math.ceil(e[0].y-e[2].y)===Math.ceil(tHeight):e[0].x+=left,e[0].y+=up,e[1].x+=left,e[1].y+=down,e[3].x+=right,e[3].y+=up;break;case Math.ceil(e[0].x-e[2].x)===Math.ceil(positionX/10*-1)&&(1===Math.ceil(e[0].y-e[2].y)||0===Math.ceil(e[0].y-e[2].y)):e[0].x+=right,e[0].y+=up,e[1].x+=left,e[1].y+=up,e[3].x+=right,e[3].y+=down;break;case(1===Math.ceil(e[0].x-e[2].x)||0===Math.ceil(e[0].x-e[2].x))&&Math.ceil(e[0].y-e[2].y)===Math.ceil(-1*tHeight):e[0].x+=right,e[0].y+=down,e[1].x+=right,e[1].y+=up,e[3].x+=left,e[3].y+=down;break;case e[2].y===e[2].y:e[0].x+=left,e[0].y+=down,e[1].x+=right,e[1].y+=down,e[3].x+=left,e[3].y+=up}break;case"#4A6EE2":switch(!0){case Math.ceil(e[0].x-e[2].x)===Math.ceil(positionX*-.1)&&Math.ceil(e[0].y-e[2].y)===Math.ceil(tHeight):e[0].x+=0,e[0].y+=2*up,e[1].x+=left,e[1].y+=up,e[3].x+=right,e[3].y+=down;break;case Math.ceil(e[0].x-e[2].x)===Math.ceil(.1*positionX)&&Math.ceil(e[0].y-e[2].y)===Math.ceil(tHeight):e[0].x+=2*left,e[0].y+=0,e[1].x+=left,e[1].y+=down,e[3].x+=right,e[3].y+=up;break;case Math.floor(Math.floor(e[0].x))===Math.floor(Math.floor(e[1].x)):e[0].x+=2*right,e[0].y+=0,e[1].x+=right,e[1].y+=up,e[3].x+=left,e[3].y+=down;break;case Math.ceil(e[0].y-e[2].y)===Math.ceil(-1*tHeight)&&Math.ceil(e[0].x-e[2].x)===Math.ceil(.1*positionX):e[0].x+=0,e[0].y+=2*down,e[1].x+=right,e[1].y+=down,e[3].x+=left,e[3].y+=up}break;case"#7ED321":switch(!0){case Math.floor(e[2].y)===Math.floor(e[1].y):e[0].x+=0,e[0].y+=2*down,e[1].x+=right,e[1].y+=down,e[3].x+=right,e[3].y+=up;break;case Math.floor(e[0].y)===Math.floor(e[1].y):e[0].x+=0,e[0].y+=2*up,e[1].x+=left,e[1].y+=up,e[3].x+=left,e[3].y+=down}break;case"#50E3C2":switch(!0){case Math.floor(e[0].y)!==Math.floor(e[1].y):e[0].x+=2*left,e[0].y+=2*down,e[1].x+=left,e[1].y+=down,e[3].x+=right,e[3].y+=up;break;case Math.floor(e[0].y)===Math.floor(e[1].y):e[0].x+=2*right,e[0].y+=2*up,e[1].x+=right,e[1].y+=up,e[3].x+=left,e[3].y+=down}break;case"#F8E71C":break;case"#D0021B":switch(!0){case Math.floor(e[2].y)!==Math.floor(e[1].y):e[0].x+=2*right,e[0].y+=0,e[1].x+=right,e[1].y+=down,e[3].x+=left,e[3].y+=down;break;case Math.floor(e[0].y)!==Math.floor(e[1].y):e[0].x+=2*left,e[0].y+=0,e[1].x+=left,e[1].y+=up,e[3].x+=right,e[3].y+=up}break;case"#E59512":switch(!0){case Math.ceil(e[0].x-e[2].x)===Math.ceil(-1*positionX/10)&&Math.ceil(e[0].y-e[2].y)===Math.ceil(-1*tHeight):e[0].x+=2*right,e[0].y+=0,e[1].x+=left,e[1].y+=up,e[3].x+=right,e[3].y+=down;break;case Math.ceil(e[0].x-e[2].x)===Math.ceil(positionX/10)&&Math.ceil(e[0].y-e[2].y)===Math.ceil(tHeight):e[0].x+=2*left,e[0].y+=0,e[1].x+=right,e[1].y+=down,e[3].x+=left,e[3].y+=up;break;case Math.ceil(e[0].x-e[2].x)===Math.ceil(positionX/10)&&Math.ceil(e[0].y-e[2].y)===Math.ceil(-1*tHeight):e[0].x+=0,e[0].y+=2*down,e[1].x+=right,e[1].y+=up,e[3].x+=left,e[3].y+=down;break;case Math.ceil(e[0].x-e[2].x)===Math.ceil(-1*positionX/10)&&Math.ceil(e[0].y-e[2].y)===Math.ceil(tHeight):e[0].x+=0,e[0].y+=2*up,e[1].x+=left,e[1].y+=down,e[3].x+=right,e[3].y+=up}}}function clear(){ctx.clearRect(0,0,canvas.width,canvas.height),floor[0].drawFallen(ctx);for(var e=0;e<fallen.length;e++)fallen[e].drawFallen(ctx)}function checkFallen(e){for(var t=0;t<fallen.length;t++){if(!(e.y<fallen[t].y-3*tHeight||e.x!==fallen[t].x))return!1;window.console.log(e.y)}return!0}function randomTetrino(){var e=Math.floor(7*Math.random()),t;switch(!0){case 0===e:return t=tBlock;case 1===e:return t=jBlock;case 2===e:return t=sBlock;case 3===e:return t=iBlock;case 4===e:return t=oBlock;case 5===e:return t=zBlock;case 6===e:return t=lBlock}}function next(){randomRotate=Math.floor(3*Math.random()),tetrino=randomTetrino();var e=document.getElementById("next");e.innerHTML="<img src='images/"+tetrino.name+".png' alt='"+tetrino.name+"'>"}function stats(e){if(e){e.number++;var t=document.getElementById(e.name);t.innerHTML=e.number}}function newRect(){var e=document.getElementById("start");e.addEventListener("click",function(e){e.preventDefault()}),e.innerHTML=" ";for(var t=0;t<tetrino.shape[0].length;t++)addShape([tetrino.shape[0][t],tetrino.name]);stats(tetrino),next()}function checkLine(e,t){fallen=fallen.sort(function(e,t){return t.y-e.y}),count=0,index=0;for(var i=0;i<fallen.length;i++)if(fallen[i].y<=t&&fallen[i].y>e&&fallen[i].x>0&&"floor"!==fallen[i].name){if(deleteArray.push(fallen[i]),count++,10===count)return count}else index++,deleteArray.length=0}function checkWin(){for(var e=0;20>e;e++){var t=checkLine(tHeight*e,tHeight*(e+1));if(t>=10){for(var i=fallen.indexOf(deleteArray[9]);i<fallen.length;i++)fallen[i].y+=Math.ceil(tHeight);for(var n=0;n<deleteArray.length;n++)fallen.splice(fallen.indexOf(deleteArray[n]),1),window.console.log("Spliced at "+n);deleteArray.length=0,score+=2e3,lines++,lines%5===0&&(level++,document.getElementById("level").innerHTML=level),window.console.log("Spliced these values: "+parseInt(index-10)+" to "+index),document.getElementById("lines").innerHTML=lines,document.getElementById("score").innerHTML=score}}}function drawing(){draw(canvas)}var tWidth=Math.floor((window.innerWidth-1)/10),tHeight=window.innerHeight/20,Rectangle=function(e,t,i,n,a){this.name=0,this.x=e,this.y=t,this.w=n,this.h=a,this.ctx=document.getElementById("canvas").getContext("2d"),this.hit=!1,(void 0===n||void 0===a)&&(this.w=tWidth-4,this.h=tHeight),this.color=i,this.drawFallen=function(){this.ctx.fillStyle=this.color,this.ctx.lineWidth="3",this.ctx.strokeStyle="black",this.ctx.strokeRect(this.x,this.y,this.w,this.h),this.ctx.fillRect(this.x,this.y,this.w,this.h)},this.draw=function(){var e=this.y;this.ctx.fillStyle=this.color,this.ctx.lineWidth="3",this.ctx.strokeStyle="black",this.ctx.strokeRect(this.x,e,this.w,this.h),this.ctx.fillRect(this.x,e,this.w,this.h)},this.drop=function(){var e=this.y;switch(level){case 1:e+=tHeight/30;break;case 2:e+=tHeight/27.5;break;case 3:e+=tHeight/25;break;case 4:e+=tHeight/22.5;break;case 5:e+=tHeight/20;break;case 6:e+=tHeight/17.5;break;case 7:e+=tHeight/15;break;case 8:e+=tHeight/12.5;break;case 9:e+=tHeight/10;break;case 10:e+=tHeight/7.5;break;case 11:e+=tHeight/5;break;case 12:e+=tHeight/2.5;break;case 13:e+=tHeight;break;case 14:e+=1.25*tHeight;break;case 15:e+=1.5*tHeight;break;case 16:e+=1.75*tHeight;break;case 17:e+=2*tHeight;break;case 18:e+=2.25*tHeight;break;case 19:e+=2.5*tHeight;break;case 20:e+=2.75*tHeight;break;case 30:return level=0,window.alert("Game Over"),fallen.length=0,fallen.length}this.y=e}};Rectangle.prototype.contains=function(e,t){return e>=this.x&&e<=this.x+this.w&&t>=this.y&&t<=this.y+this.h?!0:!1},Rectangle.prototype.intersects=function(e){return this.contains(e.x,e.y)||this.contains(e.x+e.w,e.y)||this.contains(e.x,e.y+e.h)||this.contains(e.x+e.w,e.y+e.h)?!0:e.contains(this.x,this.y)||e.contains(this.x+this.w,this.y)||e.contains(this.x,this.y+this.h)||e.contains(this.x+this.w,this.y+this.h)?!0:!1};var positionX=window.innerWidth,tBlock={name:"tBlock",color:"#9013FE",number:1e3,shape:[[new Rectangle(.4*positionX,tHeight,"#9013FE"),new Rectangle(.3*positionX,2*tHeight,"#9013FE"),new Rectangle(.4*positionX,2*tHeight,"#9013FE"),new Rectangle(.5*positionX,2*tHeight,"#9013FE")]]},jBlock={name:"jBlock",color:"#4A6EE2",number:1e3,shape:[[new Rectangle(.3*positionX,tHeight,"#4A6EE2"),new Rectangle(.3*positionX,2*tHeight,"#4A6EE2"),new Rectangle(.4*positionX,2*tHeight,"#4A6EE2"),new Rectangle(.5*positionX,2*tHeight,"#4A6EE2")]]},sBlock={name:"sBlock",color:"#7ED321",number:1e3,shape:[[new Rectangle(.3*positionX,2*tHeight,"#7ED321"),new Rectangle(.4*positionX,2*tHeight,"#7ED321"),new Rectangle(.4*positionX,tHeight,"#7ED321"),new Rectangle(.5*positionX,1*tHeight,"#7ED321")]]},iBlock={name:"iBlock",color:"#50E3C2",number:1e3,shape:[[new Rectangle(.3*positionX,tHeight,"#50E3C2",tWidth-5,tHeight),new Rectangle(.4*positionX,tHeight,"#50E3C2",tWidth-5,tHeight),new Rectangle(.5*positionX,tHeight,"#50E3C2",tWidth-5,tHeight),new Rectangle(.6*positionX,tHeight,"#50E3C2",tWidth-5,tHeight)]]},oBlock={name:"oBlock",color:"#F8E71C",number:1e3,shape:[[new Rectangle(.4*positionX,tHeight,"#F8E71C"),new Rectangle(.5*positionX,tHeight,"#F8E71C"),new Rectangle(.4*positionX,2*tHeight,"#F8E71C"),new Rectangle(.5*positionX,2*tHeight,"#F8E71C")]]},zBlock={name:"zBlock",color:"#D0021B",number:1e3,shape:[[new Rectangle(.3*positionX,tHeight,"#D0021B"),new Rectangle(.4*positionX,tHeight,"#D0021B"),new Rectangle(.4*positionX,2*tHeight,"#D0021B"),new Rectangle(.5*positionX,2*tHeight,"#D0021B")]]},lBlock={name:"lBlock",color:"#E59512",number:1e3,shape:[[new Rectangle(.5*positionX,tHeight,"#E59512"),new Rectangle(.3*positionX,2*tHeight,"#E59512"),new Rectangle(.4*positionX,2*tHeight,"#E59512"),new Rectangle(.5*positionX,2*tHeight,"#E59512")]]},up=-tHeight,down=tHeight,left=.1*-positionX,right=.1*positionX,difference,height,canvas=document.getElementById("canvas");canvas.height=window.innerHeight,canvas.width=window.innerWidth,canvas.style.width="45%",canvas.style.height="90%";var ctx=canvas.getContext("2d"),shapes=[],level=1,fallen=[new Rectangle(0,27*tHeight,"black",canvas.width,tHeight)],floor=[new Rectangle(0,20*tHeight,"black",canvas.width,tHeight)],moveLeft=function(e){if(e[0].x>.1*positionX&&e[1].x>.1*positionX&&e[2].x>.1*positionX&&e[3].x>.1*positionX)for(var t=0;t<e.length;t++)e[t].x-=tWidth},moveRight=function(e){if(e[0].x<.8*positionX&&e[1].x<.8*positionX&&e[2].x<.8*positionX&&e[3].x<.8*positionX)for(var t=0;t<e.length;t++)e[t].x+=tWidth},moveDown=function(e){checkFallen(shapes[0])&&checkFallen(shapes[1])&&checkFallen(shapes[2])&&checkFallen(shapes[3])&&e[0].y<floor[0].y-4*tHeight&&e[1].y<floor[0].y-4*tHeight&&e[2].y<floor[0].y-4*tHeight&&e[3].y<floor[0].y-4*tHeight&&(e[0].y+=tHeight,e[1].y+=tHeight,e[2].y+=tHeight,e[3].y+=tHeight)},keyControls=function(e){document.onkeydown=function(t){switch(t=t||window.event,t.which||t.keyCode){case 65:moveLeft(e);break;case 37:moveLeft(e);break;case 87:rotate(e);break;case 38:rotate(e);break;case 68:moveRight(e);break;case 39:moveRight(e);break;case 82:moveDown(e);break;case 40:moveDown(e);break;default:window.console.log(t.which),window.console.log(t.keyCode)}}},addShape=function(e){shapes.push(e[0])},randomRotate,tetrino=randomTetrino(),score=0,count=0,index=-1,lines=0,deleteArray=[],draw=function(){if(clear(),shapes.length>0)for(var e=0;e<shapes.length;e++){for(var t=0;t<fallen.length;t++)if(shapes[e].intersects(fallen[t])||shapes[e].intersects(floor[0]))return shapes[e].intersects(fallen[t])?shapes[e].y=Math.floor(fallen[t].y)-Math.floor(fallen[t].h):shapes[e].y=Math.floor(floor[0].y)-Math.floor(tHeight),shapes[e].hit=!0,shapes[0].y=Math.ceil(shapes[0].y),shapes[1].y=Math.ceil(shapes[1].y),shapes[2].y=Math.ceil(shapes[2].y),shapes[3].y=Math.ceil(shapes[3].y),fallen.push(shapes[0]),fallen.push(shapes[1]),fallen.push(shapes[2]),fallen.push(shapes[3]),shapes.splice(0,4),checkWin(),tBlock.shape=[[new Rectangle(.4*positionX,tHeight,"#9013FE"),new Rectangle(.3*positionX,2*tHeight,"#9013FE"),new Rectangle(.4*positionX,2*tHeight,"#9013FE"),new Rectangle(.5*positionX,2*tHeight,"#9013FE")]],jBlock.shape=[[new Rectangle(.3*positionX,tHeight,"#4A6EE2"),new Rectangle(.3*positionX,2*tHeight,"#4A6EE2"),new Rectangle(.4*positionX,2*tHeight,"#4A6EE2"),new Rectangle(.5*positionX,2*tHeight,"#4A6EE2")]],sBlock.shape=[[new Rectangle(.3*positionX,2*tHeight,"#7ED321"),new Rectangle(.4*positionX,2*tHeight,"#7ED321"),new Rectangle(.4*positionX,tHeight,"#7ED321"),new Rectangle(.5*positionX,1*tHeight,"#7ED321")]],iBlock.shape=[[new Rectangle(.3*positionX,tHeight,"#50E3C2",tWidth-5,tHeight),new Rectangle(.4*positionX,tHeight,"#50E3C2",tWidth-5,tHeight),new Rectangle(.5*positionX,tHeight,"#50E3C2",tWidth-5,tHeight),new Rectangle(.6*positionX,tHeight,"#50E3C2",tWidth-5,tHeight)]],oBlock.shape=[[new Rectangle(.4*positionX,tHeight,"#F8E71C"),new Rectangle(.5*positionX,tHeight,"#F8E71C"),new Rectangle(.4*positionX,2*tHeight,"#F8E71C"),new Rectangle(.5*positionX,2*tHeight,"#F8E71C")]],zBlock.shape=[[new Rectangle(.3*positionX,tHeight,"#D0021B"),new Rectangle(.4*positionX,tHeight,"#D0021B"),new Rectangle(.4*positionX,2*tHeight,"#D0021B"),new Rectangle(.5*positionX,2*tHeight,"#D0021B")]],lBlock.shape=[[new Rectangle(.5*positionX,tHeight,"#E59512"),new Rectangle(.3*positionX,2*tHeight,"#E59512"),new Rectangle(.4*positionX,2*tHeight,"#E59512"),new Rectangle(.5*positionX,2*tHeight,"#E59512")]],void setInterval(newRect(),400);this.hit||(keyControls(shapes),shapes[e].draw(),shapes[e].drop())}},myState=canvas;myState.interval=16.5,setInterval(drawing,myState.interval);